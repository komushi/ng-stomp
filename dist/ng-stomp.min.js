/**
 * ngStomp
 *
 * @version 0.7.0
 * @author Lei Xu <komushi@gmail.com>
 * @license MIT
 */
/*global
    angular, SockJS, Stomp */
!function(a){"use strict";"object"==typeof exports?
// Node/CommonJS
module.exports=a("undefined"!=typeof angular?angular:require("angular"),"undefined"!=typeof SockJS?SockJS:require("SockJS"),"undefined"!=typeof Stomp?Stomp:require("Stomp")):"function"==typeof define&&define.amd?
// AMD. Register as an anonymous module.
define(["angular","SockJS","Stomp"],a):
// Browser globals
a(angular,SockJS,Stomp)}(function(a,b,c){a.module("ngStomp",[]).service("$stomp",["$rootScope","$q",function(a,d){function e(a){var b=document.createElement("a");return b.href=a,b}
// this.sock = null
// this.debug = null
this.stomps={},
// this.setDebug = function (callback) {
//   this.debug = callback
// }
this.connect=function(a,f,g){g=g||{};var h=d.defer();if("ws:"===e(f).protocol||"wss:"===e(f).protocol){var i=new WebSocket(f);this.stomps[a]=c.over(i),this.stomps[a].subs={},this.stomps[a].debug=null}else{var j=new b(f);this.stomps[a]=c.over(j),this.stomps[a].subs={},this.stomps[a].debug=null}
// this.stomp.debug = this.debug
return this.stomps[a].connect(g,function(a){h.resolve(a)},function(a){h.reject(a)}),h.promise},this.disconnect=function(a){var b=d.defer();if(this.stomps[a]&&this.stomps[a].connected){for(var c in this.stomps[a].subs)this.unsubscribe(a,c);this.stomps[a].disconnect(b.resolve)}else b.resolve();return b.promise},this.subscribe=this.on=function(a,b,c){c=c||{};var e=d.defer();if(this.stomps[a]&&this.stomps[a].connected&&!this.stomps[a].subs[b]){var f=this.stomps[a].subscribe(b,function(a){e.notify(a)},c);this.stomps[a].subs[b]=f}return e.promise},this.unsubscribe=this.off=function(a,b){this.stomps[a]&&this.stomps[a].connected&&this.stomps[a].subs[b]&&(this.stomps[a].subs[b].unsubscribe(),delete this.stomps[a].subs[b])},this.send=function(a,b,c,e){var f=d.defer();try{var g=JSON.stringify(c);e=e||{},this.stomps[a].send(b,e,g),f.resolve()}catch(h){f.reject(h)}return f.promise}}])});