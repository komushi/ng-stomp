/**
 * ngStomp
 *
 * @version 0.6.2
 * @author Lei Xu <komushi@gmail.com>
 * @license MIT
 */
/*global
    angular, SockJS, Stomp */
!function(a){"use strict";"object"==typeof exports?
// Node/CommonJS
module.exports=a("undefined"!=typeof angular?angular:require("angular"),"undefined"!=typeof SockJS?SockJS:require("SockJS"),"undefined"!=typeof Stomp?Stomp:require("Stomp")):"function"==typeof define&&define.amd?
// AMD. Register as an anonymous module.
define(["angular","SockJS","Stomp"],a):
// Browser globals
a(angular,SockJS,Stomp)}(function(a,b,c){a.module("ngStomp",[]).service("$stomp",["$rootScope","$q",function(a,d){function e(a){var b=document.createElement("a");return b.href=a,b}this.sock=null,this.stomp=null,this.debug=null,this.setDebug=function(a){this.debug=a},this.connect=function(a,f){f=f||{};var g=d.defer();if("ws:"===e(a).protocol||"wss:"===e(a).protocol){var h=new WebSocket(a);this.stomp=c.over(h)}else this.sock=new b(a),this.stomp=c.over(this.sock);return this.stomp.debug=this.debug,this.stomp.connect(f,function(a){g.resolve(a)},function(a){g.reject(a)}),g.promise},this.disconnect=function(){var a=d.defer();if(this.stomp&&this.stomp.connected){for(var b in this.subscriptions)this.unsubscribe(b);this.stomp.disconnect(a.resolve)}else a.resolve();return a.promise},this.subscriptions={},this.subscribe=this.on=function(a,b){b=b||{};var c=d.defer();if(!this.subscriptions[a]){var e=this.stomp.subscribe(a,function(a){c.notify(a)},b);this.subscriptions[a]=e}return c.promise},this.unsubscribe=this.off=function(a){this.subscriptions[a]&&(this.subscriptions[a].unsubscribe(),delete this.subscriptions[a])},this.send=function(a,b,c){var e=d.defer();try{var f=JSON.stringify(b);c=c||{},this.stomp.send(a,c,f),e.resolve()}catch(g){e.reject(g)}return e.promise}}])});